# Constellation School Bot
**–ê–≤—Ç–æ—Ä:** –ú–∞–∫—Å–∏–º –ù–æ–≤–∏—Ö–∏–Ω  
**–î–∞—Ç–∞:** 2025-01-22 16:30 MSK

## –®–∞–≥ 4: fsm.go ‚Äì FSM + /start, /register

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM) –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã /start –∏ /register.

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

#### 1. FSM —Å–∏—Å—Ç–µ–º–∞ (`internal/handlers/fsm.go`):
- **UserState** - –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–°–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**
  - `StateIdle` - –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  - `StateWaitingName` - –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
  - `StateWaitingPhone` - –æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞  
  - `StateSelectingSubjects` - –≤—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤
  - `StateRegistered` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

- **–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π:**
  - `userStates` - —Ç–µ–∫—É—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - `userData` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### 2. –ö–æ–º–∞–Ω–¥–∞ `/start`:
- **–î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
  - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –±–æ—Ç–µ
  - Inline-–∫–Ω–æ–ø–∫–∏ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" –∏ "–ü–æ–º–æ—â—å"
  - –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–π—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

- **–î–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
  - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ —Ä–æ–ª–∏
  - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏
  - –†–∞–∑–Ω—ã–µ –º–µ–Ω—é –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤/–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π/–∞–¥–º–∏–Ω–æ–≤

#### 3. –ö–æ–º–∞–Ω–¥–∞ `/register` - –ø–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:
**–®–∞–≥ 1:** –í–≤–æ–¥ –ø–æ–ª–Ω–æ–≥–æ –∏–º–µ–Ω–∏
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏ (–º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –≤—Ä–µ–º–µ–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ FSM

**–®–∞–≥ 2:** –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞  
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –≤—ã–±–æ—Ä—É –ø—Ä–µ–¥–º–µ—Ç–æ–≤

**–®–∞–≥ 3:** –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å 6 –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ –¶–î–ö (–ø–æ 2 –≤ —Ä—è–¥—É)
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞
- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é"

**–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `users` —Å —Ä–æ–ª—å—é 'student'
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `students` —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏
- –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö FSM
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å –∏—Ç–æ–≥–∞–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### 4. –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (`internal/handlers/handlers.go`):
- **HandleUpdate()** - –≥–ª–∞–≤–Ω—ã–π —Ä–æ—É—Ç–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
- **handleMessage()** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **handleCommand()** - —Ä–æ—É—Ç–∏–Ω–≥ –∫–æ–º–∞–Ω–¥
- **handleCallbackQuery()** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ inline-–∫–Ω–æ–ø–æ–∫

#### 5. –ö–æ–º–∞–Ω–¥–∞ `/help`:
- **–î–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö:** –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–µ–¥–º–µ—Ç–∞—Ö
- **–î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:** –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∏ —É—Ä–æ–∫–∞–º–∏  
- **–î–ª—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π:** –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞–º–∏ –∏ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏
- **–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:** –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### 6. Callback-–æ–±—Ä–∞–±–æ—Ç–∫–∞:
- `cmd_register` / `cmd_help` - –±—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏
- `subject_X` - –≤—ã–±–æ—Ä/–æ—Ç–º–µ–Ω–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  
- `finish_registration` - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### 7. –û–±–Ω–æ–≤–ª–µ–Ω `main.go`:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ü–µ—Ä–µ–¥–∞—á–∞ –±–æ—Ç–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ –ë–î –≤ handlers.HandleUpdate()

### üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
1. `/start` ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
2. "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" –∏–ª–∏ `/register` ‚Üí –Ω–∞—á–∞–ª–æ FSM
3. –í–≤–æ–¥ –∏–º–µ–Ω–∏ ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ –≤–≤–æ–¥—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞  
4. –í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Üí –ø–æ–∫–∞–∑ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏
5. –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤ ‚Üí –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
6. "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é" ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î + –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

### üì± UX/UI –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- **Inline-–∫–Ω–æ–ø–∫–∏** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–º–∞–Ω–¥–∞–º
- **–ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã
- **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
- **–Ø—Å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ FSM

FSM —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö.
